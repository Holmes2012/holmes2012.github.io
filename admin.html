<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Catherine Cook School</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <header>
        <nav>
            <div class="nav-container">
                <div class="logo">
                    <a href="index.html"><h1>Catherine Cook School</h1></a>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html" class="nav-link">Home</a></li>
                    <li><a href="index.html#about" class="nav-link">About</a></li>
                    <li><a href="index.html#events" class="nav-link">Events</a></li>
                    <li><a href="index.html#contact" class="nav-link">Contact</a></li>
                    <li><a href="#" id="logout-btn" class="nav-link admin-link">Logout</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <div class="container">
            <div class="admin-header">
                <h2>Admin Panel</h2>
                <p>Manage your school website content</p>
            </div>

            <!-- Admin Dashboard -->
            <div class="admin-dashboard">
                <div class="dashboard-cards">
                    <div class="dashboard-card">
                        <h3>News Articles</h3>
                        <div class="card-number" id="news-count">-</div>
                        <p>Total news articles</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>Upcoming Events</h3>
                        <div class="card-number" id="events-count">-</div>
                        <p>Scheduled events</p>
                    </div>
                    <div class="dashboard-card">
                        <h3>Messages</h3>
                        <div class="card-number" id="messages-count">-</div>
                        <p>Contact form messages</p>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="news">News Management</button>
                <button class="tab-btn" data-tab="events">Events Management</button>
                <button class="tab-btn" data-tab="users">User Management</button>
                <button class="tab-btn" data-tab="messages">Messages</button>
            </div>

            <!-- News Management Tab -->
            <div id="news-tab" class="tab-content active">
                <div class="admin-section">
                <h3>Add News Article</h3>
                <form id="news-form" class="admin-form">
                <div class="form-row">
                <div class="form-group">
                <label for="news-title">Article Title</label>
                <input type="text" id="news-title" name="title" required placeholder="Enter article title">
                </div>
                    <div class="form-group">
                        <label for="news-author">Author</label>
                    <input type="text" id="news-author" name="author" required placeholder="Author name">
                </div>
                </div>
                <div class="form-group">
                        <label for="news-content">Article Content</label>
                            <textarea id="news-content" name="content" rows="8" required placeholder="Write your article content here..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="news-tags">Tags (optional)</label>
                                <input type="text" id="news-tags" name="tags" placeholder="e.g., academics, sports, events (comma separated)">
                            </div>
                            <button type="submit">Publish Article</button>
                        </form>
                    </div>

                <div class="admin-section">
                    <h3>Manage News Articles</h3>
                    <div id="news-list" class="content-list">
                        <div class="loading">Loading news articles...</div>
                    </div>
                </div>
            </div>

            <!-- Events Management Tab -->
            <div id="events-tab" class="tab-content">
                <div class="admin-section">
                    <h3>Add Event</h3>
                    <form id="event-form" class="admin-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-title">Event Title</label>
                                <input type="text" id="event-title" name="title" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-date">Date</label>
                                <input type="date" id="event-date" name="date" required>
                            </div>
                            <div class="form-group">
                                <label for="event-time">Time</label>
                                <input type="time" id="event-time" name="time">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="event-description">Description</label>
                            <textarea id="event-description" name="description" rows="4"></textarea>
                        </div>
                        <button type="submit">Add Event</button>
                    </form>
                </div>

                <div class="admin-section">
                    <h3>Manage Events</h3>
                    <div id="events-list" class="content-list">
                        <div class="loading">Loading events...</div>
                    </div>
                </div>
            </div>

            <!-- User Management Tab -->
            <div id="users-tab" class="tab-content">
                <div class="admin-section">
                    <h3>Create New User</h3>
                    <form id="user-form" class="admin-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="user-username">Username</label>
                                <input type="text" id="user-username" name="username" required placeholder="Enter username">
                            </div>
                            <div class="form-group">
                                <label for="user-email">Email</label>
                                <input type="email" id="user-email" name="email" required placeholder="Enter email">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="user-password">Password</label>
                                <input type="password" id="user-password" name="password" required placeholder="Enter password">
                            </div>
                            <div class="form-group">
                                <label for="user-role">Role</label>
                                <select id="user-role" name="role" required>
                                    <option value="">Select Role</option>
                                    <option value="student">Student</option>
                                    <option value="teacher">Teacher</option>
                                    <option value="staff">Staff</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="user-fullname">Full Name</label>
                            <input type="text" id="user-fullname" name="fullname" required placeholder="Enter full name">
                        </div>
                        <button type="submit">Create User</button>
                    </form>
                </div>

                <div class="admin-section">
                    <h3>Manage Users</h3>
                    <div class="user-filters">
                        <button class="filter-btn active" data-filter="all">All Users</button>
                        <button class="filter-btn" data-filter="student">Students</button>
                        <button class="filter-btn" data-filter="teacher">Teachers</button>
                        <button class="filter-btn" data-filter="staff">Staff</button>
                    </div>
                    <div id="users-list" class="content-list">
                        <div class="loading">Loading users...</div>
                    </div>
                </div>
            </div>

            <!-- Messages Tab -->
            <div id="messages-tab" class="tab-content">
                <div class="admin-section">
                    <h3>Contact Messages</h3>
                    <div id="messages-list" class="content-list">
                        <div class="loading">Loading messages...</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="config.js"></script>
    <script>
        // Check authentication
        function checkAuth() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            const loginTime = localStorage.getItem('adminLoginTime');
            const currentTime = new Date().getTime();
            
            if (!isLoggedIn || !loginTime || (currentTime - loginTime > 7200000)) {
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminLoginTime');
                window.location.href = 'login.html';
                return false;
            }
            return true;
        }

        // Initialize admin panel
        if (checkAuth()) {
            document.addEventListener('DOMContentLoaded', () => {
                initializeAdmin();
            });
        }

        // Initialize admin functionality
        function initializeAdmin() {
            loadDashboardStats();
            loadNews();
            loadEvents();
            loadUsers();
            loadMessages();
            setupForms();
            setupTabs();
            setupLogout();
        }

        // Load dashboard statistics
        async function loadDashboardStats() {
            try {
                // Count news
                const { count: newsCount } = await supabase
                    .from('news')
                    .select('*', { count: 'exact', head: true });
                document.getElementById('news-count').textContent = newsCount || 0;

                // Count upcoming events
                const { count: eventsCount } = await supabase
                    .from('events')
                    .select('*', { count: 'exact', head: true })
                    .gte('event_date', new Date().toISOString().split('T')[0]);
                document.getElementById('events-count').textContent = eventsCount || 0;

                // Count messages
                const { count: messagesCount } = await supabase
                    .from('contacts')
                    .select('*', { count: 'exact', head: true });
                document.getElementById('messages-count').textContent = messagesCount || 0;

            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        // Load news for management
        async function loadNews() {
            const newsList = document.getElementById('news-list');
            
            try {
                const { data: news, error } = await window.supabase
                    .from('news')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                let allNews = [];
                
                if (error && error.message.includes('Mock client')) {
                    // Load from local storage only
                    allNews = JSON.parse(localStorage.getItem('localNews') || '[]');
                } else if (!error && news) {
                    // Combine database and local news
                    const localNews = JSON.parse(localStorage.getItem('localNews') || '[]');
                    allNews = [...news, ...localNews].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
                } else {
                    // Fallback to local only
                    allNews = JSON.parse(localStorage.getItem('localNews') || '[]');
                }
                
                if (allNews && allNews.length > 0) {
                    newsList.innerHTML = allNews.map(item => `
                        <div class="content-item article-preview">
                            <div class="content-header">
                                <h4 class="article-title">${item.title}</h4>
                                <div class="content-actions">
                                    <button onclick="viewArticle('${item.id}')" class="btn-secondary">View</button>
                                    <button onclick="deleteNews('${item.id}')" class="btn-danger">Delete</button>
                                </div>
                            </div>
                            <div class="article-meta">
                                <span class="article-author">By ${item.author || 'Anonymous'}</span>
                                ${item.tags ? `<span class="article-tags">${item.tags}</span>` : ''}
                            </div>
                            <p class="content-preview">${item.content.substring(0, 150)}...</p>
                            <div class="content-date">${formatDate(item.created_at || item.published_at)}</div>
                        </div>
                    `).join('');
                } else {
                    newsList.innerHTML = '<div class="no-content">No news articles found. Create one above!</div>';
                }
            } catch (error) {
                console.error('Error loading news:', error);
                // Load local news as fallback
                const localNews = JSON.parse(localStorage.getItem('localNews') || '[]');
                if (localNews.length > 0) {
                    newsList.innerHTML = localNews.map(item => `
                        <div class="content-item article-preview">
                            <div class="content-header">
                                <h4 class="article-title">${item.title}</h4>
                                <div class="content-actions">
                                    <button onclick="viewArticle('${item.id}')" class="btn-secondary">View</button>
                                    <button onclick="deleteNews('${item.id}')" class="btn-danger">Delete</button>
                                </div>
                            </div>
                            <div class="article-meta">
                                <span class="article-author">By ${item.author || 'Anonymous'}</span>
                                ${item.tags ? `<span class="article-tags">${item.tags}</span>` : ''}
                            </div>
                            <p class="content-preview">${item.content.substring(0, 150)}...</p>
                            <div class="content-date">${formatDate(item.created_at || item.published_at)}</div>
                        </div>
                    `).join('');
                } else {
                    newsList.innerHTML = '<div class="no-content">No news articles found. Database connection failed - using local storage.</div>';
                }
            }
        }

        // Load events for management
        async function loadEvents() {
            const eventsList = document.getElementById('events-list');
            
            try {
                const { data: events, error } = await window.supabase
                    .from('events')
                    .select('*')
                    .order('event_date', { ascending: true });
                
                let allEvents = [];
                
                if (error && error.message.includes('Mock client')) {
                    allEvents = JSON.parse(localStorage.getItem('localEvents') || '[]');
                } else if (!error && events) {
                    const localEvents = JSON.parse(localStorage.getItem('localEvents') || '[]');
                    allEvents = [...events, ...localEvents].sort((a, b) => new Date(a.event_date) - new Date(b.event_date));
                } else {
                    allEvents = JSON.parse(localStorage.getItem('localEvents') || '[]');
                }
                
                if (allEvents && allEvents.length > 0) {
                    eventsList.innerHTML = allEvents.map(event => `
                        <div class="content-item">
                            <div class="content-header">
                                <h4>${event.title}</h4>
                                <div class="content-actions">
                                    <button onclick="deleteEvent('${event.id}')" class="btn-danger">Delete</button>
                                </div>
                            </div>
                            <p class="content-preview">${event.description || 'No description'}</p>
                            <div class="content-date">${formatDate(event.event_date)} ${event.event_time || ''}</div>
                        </div>
                    `).join('');
                } else {
                    eventsList.innerHTML = '<div class="no-content">No events found. Create one above!</div>';
                }
            } catch (error) {
                console.error('Error loading events:', error);
                const localEvents = JSON.parse(localStorage.getItem('localEvents') || '[]');
                if (localEvents.length > 0) {
                    eventsList.innerHTML = localEvents.map(event => `
                        <div class="content-item">
                            <div class="content-header">
                                <h4>${event.title}</h4>
                                <div class="content-actions">
                                    <button onclick="deleteEvent('${event.id}')" class="btn-danger">Delete</button>
                                </div>
                            </div>
                            <p class="content-preview">${event.description || 'No description'}</p>
                            <div class="content-date">${formatDate(event.event_date)} ${event.event_time || ''}</div>
                        </div>
                    `).join('');
                } else {
                    eventsList.innerHTML = '<div class="no-content">No events found. Database connection failed - using local storage.</div>';
                }
            }
        }

        // Load messages
        async function loadMessages() {
            const messagesList = document.getElementById('messages-list');
            
            try {
                const { data: messages, error } = await supabase
                    .from('contacts')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                if (messages && messages.length > 0) {
                    messagesList.innerHTML = messages.map(message => `
                        <div class="content-item">
                            <div class="content-header">
                                <h4>${message.name} (${message.email})</h4>
                                <div class="content-actions">
                                    <button onclick="deleteMessage(${message.id})" class="btn-danger">Delete</button>
                                </div>
                            </div>
                            <p class="content-preview">${message.message}</p>
                            <div class="content-date">${formatDate(message.created_at)}</div>
                        </div>
                    `).join('');
                } else {
                    messagesList.innerHTML = '<div class="no-content">No messages found.</div>';
                }
            } catch (error) {
                console.error('Error loading messages:', error);
                messagesList.innerHTML = '<div class="error">Error loading messages.</div>';
            }
        }

        // Load users for management
        async function loadUsers() {
            const usersList = document.getElementById('users-list');
            
            try {
                // Try to load from Supabase first
                const { data: users, error } = await window.supabase
                    .from('users')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                let allUsers = [];
                const localUsers = getLocalUsers();
                const storedUsers = JSON.parse(localStorage.getItem('localUsers') || '[]');
                
                if (error && (error.message.includes('Mock client') || error.message.includes('relation "users" does not exist'))) {
                    // Use local users only
                    allUsers = [...localUsers, ...storedUsers];
                } else if (!error && users) {
                    // Combine all user sources
                    allUsers = [...users, ...localUsers, ...storedUsers];
                } else {
                    // Fallback to local only
                    allUsers = [...localUsers, ...storedUsers];
                }
                
                displayUsers(allUsers, usersList);
                
            } catch (error) {
                console.error('Error loading users:', error);
                const localUsers = getLocalUsers();
                displayUsers(localUsers, usersList);
            }
        }

        // Get local users (demo users)
        function getLocalUsers() {
            return [
                {
                    id: 'admin-demo',
                    username: 'admin',
                    email: 'admin@catherinecook.org',
                    role: 'admin',
                    full_name: 'System Administrator',
                    created_at: new Date().toISOString(),
                    is_local: true
                },
                {
                    id: 'student-demo',
                    username: 'student',
                    email: 'student@catherinecook.org',
                    role: 'student',
                    full_name: 'Demo Student',
                    created_at: new Date().toISOString(),
                    is_local: true
                }
            ];
        }

        // Display users in the list
        function displayUsers(users, container) {
            if (users && users.length > 0) {
                container.innerHTML = users.map(user => `
                    <div class="content-item user-item" data-role="${user.role}">
                        <div class="content-header">
                            <div class="user-info-section">
                                <h4>${user.full_name || user.username}</h4>
                                <div class="user-details">
                                    <span class="user-role ${user.role}">${user.role.toUpperCase()}</span>
                                    <span class="user-email">${user.email}</span>
                                </div>
                            </div>
                            <div class="content-actions">
                                ${!user.is_local ? `<button onclick="deleteUser('${user.id}')" class="btn-danger">Delete</button>` : '<span class="system-user">System User</span>'}
                            </div>
                        </div>
                        <div class="content-date">Created: ${formatDate(user.created_at)}</div>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<div class="no-content">No users found.</div>';
            }
        }

        // Setup forms
        function setupForms() {
            // User creation form
            document.getElementById('user-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const username = document.getElementById('user-username').value;
                const email = document.getElementById('user-email').value;
                const password = document.getElementById('user-password').value;
                const role = document.getElementById('user-role').value;
                const fullname = document.getElementById('user-fullname').value;
                
                // Validate inputs
                if (password.length < 6) {
                    showMessage('Password must be at least 6 characters long.', 'error');
                    return;
                }

                // Check if username already exists
                const existingUsers = getLocalUsers().concat(JSON.parse(localStorage.getItem('localUsers') || '[]'));
                if (existingUsers.some(user => user.username === username)) {
                    showMessage('Username already exists. Please choose a different username.', 'error');
                    return;
                }

                try {
                    // Try to save to Supabase
                    const userData = {
                        username,
                        email,
                        password_hash: btoa(password), // Basic encoding (use proper hashing in production)
                        role,
                        full_name: fullname,
                        is_active: true
                    };

                    const { error } = await window.supabase
                        .from('users')
                        .insert([userData]);
                    
                    if (error && (error.message.includes('Mock client') || error.message.includes('relation "users" does not exist'))) {
                        // If users table doesn't exist or no database, save locally
                        saveUserLocally(userData);
                        showMessage('✅ User created successfully! (Saved locally - set up database for persistence)', 'success');
                    } else if (error) {
                        throw error;
                    } else {
                        showMessage('✅ User created successfully in database!', 'success');
                    }
                    
                    e.target.reset();
                    loadUsers();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error creating user:', error);
                    // Fallback to local storage
                    const userData = {
                        username,
                        email,
                        password_hash: btoa(password),
                        role,
                        full_name: fullname,
                        is_active: true
                    };
                    saveUserLocally(userData);
                    showMessage('✅ User created locally! (Database connection failed)', 'success');
                    e.target.reset();
                    loadUsers();
                }
            });

            // News form
            document.getElementById('news-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const title = document.getElementById('news-title').value;
                const author = document.getElementById('news-author').value;
                const content = document.getElementById('news-content').value;
                const tags = document.getElementById('news-tags').value;
                
                const newsData = {
                    title,
                    author,
                    content,
                    tags: tags || null,
                    published_at: new Date().toISOString()
                };
                
                try {
                    const { error } = await window.supabase
                        .from('news')
                        .insert([newsData]);
                    
                    if (error && error.message.includes('Mock client')) {
                        // Save locally when database is not connected
                        saveNewsLocally(newsData);
                        showMessage('Article published locally! (Set up database for persistence)', 'success');
                    } else if (error) {
                        throw error;
                    } else {
                        showMessage('Article published successfully!', 'success');
                    }
                    
                    e.target.reset();
                    loadNews();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error publishing article:', error);
                    saveNewsLocally(newsData);
                    showMessage('Article published locally! (Database connection failed)', 'success');
                    e.target.reset();
                    loadNews();
                }
            });

            // Event form
            document.getElementById('event-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const title = document.getElementById('event-title').value;
                const event_date = document.getElementById('event-date').value;
                const event_time = document.getElementById('event-time').value;
                const description = document.getElementById('event-description').value;
                
                const eventData = { title, event_date, event_time, description };
                
                try {
                    const { error } = await window.supabase
                        .from('events')
                        .insert([eventData]);
                    
                    if (error && error.message.includes('Mock client')) {
                        saveEventLocally(eventData);
                        showMessage('Event saved locally! (Set up database for persistence)', 'success');
                    } else if (error) {
                        throw error;
                    } else {
                        showMessage('Event added successfully!', 'success');
                    }
                    
                    e.target.reset();
                    loadEvents();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error adding event:', error);
                    saveEventLocally(eventData);
                    showMessage('Event saved locally! (Database connection failed)', 'success');
                    e.target.reset();
                    loadEvents();
                }
            });

            // User filter buttons
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    const filter = btn.getAttribute('data-filter');
                    
                    // Update active button
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    // Filter users
                    filterUsers(filter);
                });
            });
        }

        // Save user locally (fallback when database is not set up)
        function saveUserLocally(userData) {
            let localUsers = JSON.parse(localStorage.getItem('localUsers') || '[]');
            userData.id = Date.now().toString();
            userData.created_at = new Date().toISOString();
            localUsers.push(userData);
            localStorage.setItem('localUsers', JSON.stringify(localUsers));
        }

        // Save news locally
        function saveNewsLocally(newsData) {
            let localNews = JSON.parse(localStorage.getItem('localNews') || '[]');
            newsData.id = Date.now().toString();
            newsData.created_at = new Date().toISOString();
            localNews.unshift(newsData); // Add to beginning
            localStorage.setItem('localNews', JSON.stringify(localNews));
        }

        // Save event locally  
        function saveEventLocally(eventData) {
            let localEvents = JSON.parse(localStorage.getItem('localEvents') || '[]');
            eventData.id = Date.now().toString();
            eventData.created_at = new Date().toISOString();
            localEvents.push(eventData);
            localStorage.setItem('localEvents', JSON.stringify(localEvents));
        }

        // Filter users by role
        function filterUsers(role) {
            const userItems = document.querySelectorAll('.user-item');
            userItems.forEach(item => {
                if (role === 'all' || item.getAttribute('data-role') === role) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Setup tabs
        function setupTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const targetTab = btn.getAttribute('data-tab');
                    
                    // Remove active class from all
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to current
                    btn.classList.add('active');
                    document.getElementById(targetTab + '-tab').classList.add('active');
                });
            });
        }

        // Setup logout
        function setupLogout() {
            document.getElementById('logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('adminLoggedIn');
                localStorage.removeItem('adminLoginTime');
                window.location.href = 'login.html';
            });
        }

        // Delete functions
        async function deleteNews(id) {
            if (confirm('Are you sure you want to delete this news article?')) {
                try {
                    const { error } = await supabase
                        .from('news')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    showMessage('News article deleted successfully!', 'success');
                    loadNews();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error deleting news:', error);
                    showMessage('Error deleting news article.', 'error');
                }
            }
        }

        async function deleteEvent(id) {
            if (confirm('Are you sure you want to delete this event?')) {
                try {
                    const { error } = await supabase
                        .from('events')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    showMessage('Event deleted successfully!', 'success');
                    loadEvents();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error deleting event:', error);
                    showMessage('Error deleting event.', 'error');
                }
            }
        }

        async function deleteMessage(id) {
            if (confirm('Are you sure you want to delete this message?')) {
                try {
                    const { error } = await supabase
                        .from('contacts')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    showMessage('Message deleted successfully!', 'success');
                    loadMessages();
                    loadDashboardStats();
                } catch (error) {
                    console.error('Error deleting message:', error);
                    showMessage('Error deleting message.', 'error');
                }
            }
        }

        // View article
        function viewArticle(id) {
            window.open(`article.html?id=${id}`, '_blank');
        }

        // Utility functions
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        function showMessage(text, type) {
            const existingMessages = document.querySelectorAll('.message');
            existingMessages.forEach(msg => msg.remove());
            
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            
            const container = document.querySelector('.container');
            container.insertBefore(message, container.firstChild);
            
            setTimeout(() => {
                message.remove();
            }, 5000);
        }

        // Make functions globally available
        window.deleteNews = deleteNews;
        window.deleteEvent = deleteEvent;
        window.deleteMessage = deleteMessage;
        window.viewArticle = viewArticle;
    </script>
</body>
</html>
